$(document).ready(function(){function a(a){$.post("/api/scrape",{url:a}).then(function(a){console.log("Added new item!",a.title),window.location.replace("/dashboard")}).catch(a=>{$(".error-msg").removeClass("invisible"),$(".error-msg").addClass("animate__animated animate__zoomIn"),console.log(a.responseText),setTimeout(()=>{window.location.replace("/dashboard")},2e3)})}let b=moment().format("ll");$.get("/api/currencies").then(function(a){(function(a){var c="";for(const b in a)c+="<tr><td>"+b+":</td><td>"+a[b]+"</td><td></tr>";$("#date").text(b),$("#table tbody").append(c)})(a)}).catch(a=>{console.log(a),window.location.replace("/dashboard")}),$(window).on("load",function(){$(window).scroll(function(){let a=$(this).scrollTop()+$(this).innerHeight();$(".fade").each(function(){let b=$(this).offset().top;b+50<a&&0==$(this).css("opacity")&&$(this).fadeTo(200,1)})}).scroll()}),$.get("/api/user_data").then(a=>{$(".member-name").text(a.email)}),$("#logout").on("click",()=>{sessionStorage.removeItem("session"),window.location.replace("/logout")}),$("#logo-ws").on("click",()=>{console.log("redirecting to dash..."),window.location.replace("/dashboard")});const c=$("form#add-item-form"),d=$("input#url-input");c.on("submit",b=>{b.preventDefault();let c={url:d.val().trim()};c.url&&(a(c.url),$(".loader").removeClass("invisible"),d.val(""))});const e=$("form#add-note"),f=$("textarea#note-input"),g=$("button#selected-id").attr("data-item-id");f.val($("#note").text());const h=a=>{$.ajax({url:"/api/items/"+a.id,type:"PUT",data:a,success:b=>{console.log(b,a.id," item is updated"),window.location.replace("/item/"+a.id)}}).fail(a=>{console.log(a),window.location.replace("/dashboard")})};e.on("submit",a=>{a.preventDefault();const b={id:g,note:f.val().trim()};h(b),f.val("")});const i=$("form#add-category"),j=$("input#category-input"),k=a=>{$.ajax({url:"/api/items/"+a.id,type:"PUT",data:a,success:function(){console.log("item is updated!"),window.location.replace("/item/"+a.id)}}).fail(a=>{console.log(a),window.location.replace("/dashboard")})};i.on("submit",a=>{a.preventDefault();const b={id:g,category:j.val().trim()};k(b),j.val("")}),$(".view-item").on("click",function(){const a=$(this).attr("data-item-id");window.location.replace("/item/"+a)}),$(".back-to-dash").on("click",function(){console.log("redirecting to dash..."),window.location.replace("/dashboard")}),$(".delete").on("click",function(){const a=$(this).attr("data-id");$(".loader").removeClass("invisible"),$.ajax({url:"/api/items/"+a,type:"DELETE",success:function(a){console.log(a," item is deleted"),window.location.replace("/dashboard")}}).fail(a=>{console.log(a),window.location.replace("/dashboard")})});const l=async(a,b)=>{await $.ajax({url:"/api/scrape/"+a,type:"POST",success:b()}).fail(a=>{console.log(a),window.location.replace("/dashboard")})};$(".check-update").on("click",async function(){const a=$(this).attr("data-id");console.log("checking update on Item: ",a),$(".loader").removeClass("invisible"),await l(a,function(){}),window.location.replace("/dashboard")}),$(".check-update-view").on("click",async function(){const a=$(this).attr("data-id");console.log("checking update on Item: ",a),$(".loader").removeClass("invisible"),await l(a,function(){}),window.location.replace("/item/"+a)});const m=async a=>{$(".spinner-small").removeClass("invisible"),$("#updating").text(" Checking...");const b=a.map(async a=>{const b=await l(a.id,()=>{});return b});await Promise.all(b),window.location.replace("/dashboard")};$("#update-all").on("click",async function(){$.get("/api/items").then(a=>{console.log("Checking items for update in background"),m(a)}).fail(a=>{console.log(a),window.location.replace("/dashboard")})});const n=sessionStorage.getItem("session");n||($("#update-all").trigger("click"),console.log("Click update all"),sessionStorage.setItem("session",!0))});